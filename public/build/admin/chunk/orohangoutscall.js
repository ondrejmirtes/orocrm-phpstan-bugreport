(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[519],{"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/orohangoutscall/templates/hangouts-app-log-call-form.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form action="#">\n    <h3>'+(null==(__t=_.__("oro.hangoutscall.log_call_form.title"))?"":_.escape(__t))+'</h3>\n    <div class="control-group">\n        <div class="control-label">\n            <label for="field-call-subject"\n                   class="required">'+(null==(__t=_.__("oro.hangoutscall.log_call_form.field_subject.label"))?"":_.escape(__t))+'</label>\n        </div>\n        <div class="controls"><input type="text" id="field-call-subject" name="subject"/></div>\n    </div>\n    <div class="control-group">\n        <div class="control-label">\n            <label for="field-call-notes"\n                   class="required">'+(null==(__t=_.__("oro.hangoutscall.log_call_form.field_subject.notes"))?"":_.escape(__t))+'</label>\n        </div>\n        <div class="controls"><textarea id="field-call-notes" name="notes"></textarea></div>\n    </div>\n</form>\n';return __p}},"../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/orohangoutscall/templates/invite-modal-content.html":(module,__unused_webpack_exports,__webpack_require__)=>{var _=__webpack_require__("./bundles/oroui/js/extend/underscore.js");module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<strong>"+(null==(__t=_.__("oro.hangoutscall.start_hangouts_dialog.content_intro",{},invites.length))?"":_.escape(__t))+":</strong>\n\n",invites.length&&(__p+='\n    <table class="invite-hangout-modal-participants">\n    ',_.each(invites,(function(t){__p+='\n        <tr>\n            <td class="invite-hangout-modal-participant-name">'+(null==(__t=t.name)?"":_.escape(__t))+'</td>\n            <td class="invite-hangout-modal-participant-id">'+(null==(__t=t.id)?"":_.escape(__t))+"</td>\n        </tr>\n    "})),__p+="\n    </table>\n"),__p+='\n\n<p class="invite-hangout-modal-note">\n    '+(null==(__t=_.__("oro.hangoutscall.start_hangouts_dialog.content_note"))?"":_.escape(__t))+"\n</p>\n";return __p}},"./bundles/orohangoutscall/js/app/components/calendar-event-start-hangout-component.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/extend/underscore.js"),o=n("./bundles/orohangoutscall/js/app/views/start-button-view.js");return n("./bundles/oroui/js/app/components/base/component.js").extend({calendarEvent:null,hangoutOptions:null,ownerUserId:null,declinedStatus:null,constructor:function t(e){t.__super__.constructor.call(this,e)},initialize:function(t){if(e.extend(this,e.defaults(e.pick(t,["calendarEvent","hangoutOptions","ownerUserId","declinedStatus"]),{hangoutOptions:{}})),!this.calendarEvent)throw new TypeError('Missing required option "calendarEvent"');this.startButtonView=new o({el:t._sourceElement,hangoutOptions:this.hangoutOptions});const n=this.getAttendeesApplicableToInvite();n.length?this.renderStartButton(n):this.disableStartButton()},getAttendeesApplicableToInvite:function(){return e.filter(this.calendarEvent.attendees,(function(t){return t.status!==this.declinedStatus&&t.email&&t.email.length>0&&t.userId!==this.ownerUserId}),this)},renderStartButton:function(t){const n=e.map(t,(function(t){return{id:t.email,invite_type:"EMAIL"}}));this.startButtonView.setHangoutOptions(e.extend({},this.hangoutOptions,{invites:n})),this.startButtonView.render()},disableStartButton:function(){this.startButtonView.disable()}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/components/invite-hangout-component.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/extend/underscore.js"),o=n("./bundles/oroui/js/mediator.js"),s=n("./bundles/orotranslation/js/translator.js"),i=n("./bundles/orohangoutscall/js/app/views/invite-button-view.js"),l=n("./bundles/orohangoutscall/js/app/views/invite-modal-view.js"),a=n("./bundles/orohangoutscall/js/hangouts-event-broker.js"),r=n("./bundles/oroui/js/app/components/widget-component.js");return n("./bundles/oroui/js/app/components/base/component.js").extend({modalOptions:null,onAppStartOptions:null,eventBroker:null,constructor:function t(e){t.__super__.constructor.call(this,e)},initialize:function(t){e.extend(this,e.defaults(e.pick(t,["modalOptions","onAppStartOptions"]),{modalOptions:{}})),this.inviteButtonView=new i({el:t._sourceElement[0]}),this.listenTo(this.inviteButtonView,"invite",this.openInviteModal)},openInviteModal:function(){this.ensureEventBroker();const t=e.extend({token:this.eventBroker.getToken()},this.modalOptions);this.inviteModal=new l(t),this.listenTo(this.inviteModal,{hidden:this.onInviteModalHide,fail:this.onStartButtonFail,"application-start":this.onHangoutAppStart}),this.inviteModal.open()},ensureEventBroker:function(){this.eventBroker&&this.unsetEventBroker(),this.eventBroker=new a,this.listenTo(this.eventBroker,"application-start",this.onHangoutAppStart)},unsetEventBroker:function(){this.stopListening(this.eventBroker),this.eventBroker.dispose(),delete this.eventBroker},unsetInviteModal:function(){this.stopListening(this.inviteModal),delete this.inviteModal},onInviteModalHide:function(){this.unsetInviteModal()},onStartButtonFail:function(){this.inviteModal&&this.inviteModal.close(),o.execute("showErrorMessage",s("oro.hangoutscall.messages.connection_error"))},onHangoutAppStart:function(){this.inviteModal&&this.inviteModal.close();const t=this.eventBroker;this.stopListening(this.eventBroker),delete this.eventBroker;const e=this.onAppStartOptions;e&&e.widgetComponentOptions&&e.targetComponentName?this.passEventBrokerToComponentOfWidget(e.widgetComponentOptions,e.targetComponentName,t):t.dispose()},passEventBrokerToComponentOfWidget:function(t,n,o){const s=new r(t);s.openWidget().done((function(t){if(t&&t.pageComponent(n)){const s=t.pageComponent(n);if(e.isFunction(s.setExternalEventBroker))return void s.setExternalEventBroker(o)}o.dispose()})).fail((function(){o.dispose()})).always((function(){s.dispose()}))}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/components/log-call-component.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/extend/underscore.js"),o=n("./bundles/orohangoutscall/js/app/views/log-call/subject-field-view.js"),s=n("./bundles/orohangoutscall/js/app/views/log-call/notes-field-view.js"),i=n("./bundles/orohangoutscall/js/app/views/log-call/phone-field-view.js"),l=n("./bundles/orohangoutscall/js/app/views/log-call/duration-field-view.js"),a=n("./bundles/orohangoutscall/js/app/views/log-call/call-datetime-field-view.js"),r=n("./bundles/orohangoutscall/js/app/views/start-button-view.js"),u=n("./bundles/orohangoutscall/js/hangouts-event-broker.js"),c=n("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/orohangoutscall/templates/hangouts-app-log-call-form.html"),d=n("./bundles/oroui/js/app/components/base/component.js").extend({eventBroker:null,constructor:function t(e){t.__super__.constructor.call(this,e)},initialize:function(t){d.__super__.initialize.call(this,t),this.hangoutOptions=e.clone(t.hangoutOptions||{}),this.setEventBroker(new u),this.initViews(t)},setEventBroker:function(t){this.eventBroker&&(this.stopListening(this.eventBroker),this.eventBroker.dispose()),this.eventBroker=t,this.listenTo(this.eventBroker,{"application-start":this.onApplicationStart,"call-started":this.onCallStart,"call-is-going":this.onCallIsGoing,"call-ended":this.onCallEnd,"form-data-change":this.onFormDataChange})},setExternalEventBroker:function(t){this.setEventBroker(t),this.eventBroker.repeatTriggerFor(this),this.startButtonView.disable()},initViews:function(t){this.startButtonView=new r({autoRender:!0,el:t._sourceElement,hangoutOptions:t.hangoutOptions||{},token:this.eventBroker.getToken()});const e=t._sourceElement.closest("form, .ui-dialog"),n=e.find('[name$="[subject]"]');n.length&&(this.subjectFieldView=new o({el:n[0]}));const u=e.find('[name$="[notes]"]');u.length&&(this.notesFieldView=new s({el:u[0]}));const c=e.find('[name$="[phoneNumber]"]');c.length&&(this.phoneFieldView=new i({el:c[0]}),this.listenTo(this.phoneFieldView,"change",this.updateStartButton));const d=e.find('[name$="[duration]"]');d.length&&(this.durationFieldView=new l({el:d[0]}));const p=e.find('[name$="[callDateTime]"]');p.length&&(this.callDatetimeFieldView=new a({el:p[0]}))},updateStartButton:function(t){t?this.hangoutOptions.invites=[{id:t,invite_type:t.match(/^.+@.+\..+$/)?"EMAIL":"PHONE"}]:delete this.hangoutOptions.invites,this.startButtonView.setHangoutOptions(this.hangoutOptions),this.startButtonView.render()},onApplicationStart:function(){this.eventBroker.dispatchToApp("set:appPageHTML",c({}))},onCallStart:function(t){if(this.phoneFieldView&&t.number){const e=/[^\d]/g,n=this.phoneFieldView.getValue().replace(e,""),o=t.number.replace(e,"");n.slice(-o.length)!==o&&this.phoneFieldView.setValue(t.number)}this.callDatetimeFieldView&&this.callDatetimeFieldView.setValue(t.startedAt)},onCallIsGoing:function(t){this.durationFieldView&&this.durationFieldView.setValue(Math.floor(t.duration/1e3))},onCallEnd:function(t){this.durationFieldView&&this.durationFieldView.setValue(Math.round(t.duration/1e3))},onFormDataChange:function(t){this.subjectFieldView&&void 0!==t.subject&&this.subjectFieldView.setValue(t.subject),this.notesFieldView&&void 0!==t.notes&&this.notesFieldView.setValue(t.notes)}});return d}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/invite-button-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";return n("./bundles/oroui/js/app/views/base/view.js").extend({events:{click:function(){this.trigger("invite")}},constructor:function t(e){t.__super__.constructor.call(this,e)}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/invite-modal-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/extend/underscore.js"),o=n("./bundles/orotranslation/js/translator.js"),s=n("./bundles/oroui/js/modal.js"),i=n("./bundles/orohangoutscall/js/app/views/start-button-view.js"),l=n("../node_modules/@oroinc/oro-webpack-config-builder/loader/tpl-loader.js!./bundles/orohangoutscall/templates/invite-modal-content.html"),a=s.extend({className:"modal oro-modal-normal invite-hangout-modal",startButtonView:null,token:null,hangoutOptions:null,constructor:function t(e){t.__super__.constructor.call(this,e)},initialize:function(t){e.extend(this,e.defaults(e.pick(t,["hangoutOptions","token"]),{hangoutOptions:{}})),a.__super__.initialize.call(this,t)},getContentTemplateData:function(){return{invites:this.hangoutOptions.invites||[]}},render:function(){return this.options.title=o("oro.hangoutscall.start_hangouts_dialog.title"),this.options.content=l(this.getContentTemplateData()),a.__super__.render.call(this),this.startButtonView=new i({autoRender:!0,hangoutOptions:this.hangoutOptions,token:this.token}),this.listenTo(this.startButtonView,"click",(function(){this.trigger("application-start")})),this.startButtonView.deferredRender&&this.startButtonView.deferredRender.fail((()=>{this.trigger("fail")})),this.$(".modal-footer").append(this.startButtonView.$el),this},remove:function(){this.startButtonView&&(this.startButtonView.dispose(),delete this.startButtonView),a.__super__.remove.call(this)}});return a}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/log-call/call-datetime-field-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/orolocale/js/moment-l10n.js"),o=n("./bundles/orolocale/js/formatter/datetime.js");return n("./bundles/oroui/js/app/views/base/view.js").extend({constructor:function t(e){t.__super__.constructor.call(this,e)},getValue:function(){const t=this.$el.val();return e(t).toJSON()},setValue:function(t){t=e(t).utc().format(o.backendFormats.datetime),this.$el.val(t).trigger("change")}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/log-call/duration-field-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/orolocale/js/formatter/number.js");return n("./bundles/oroui/js/app/views/base/view.js").extend({constructor:function t(e){t.__super__.constructor.call(this,e)},getValue:function(){const t=this.$el.val();return e.unformatDuration(t)},setValue:function(t){const n=e.formatDuration(t);this.$el.val(n).trigger("change")}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/log-call/notes-field-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/extend/underscore.js"),o=n("./bundles/oroui/js/app/views/base/view.js");return n("./bundles/oroui/js/extend/select2.js"),o.extend({constructor:function t(e){t.__super__.constructor.call(this,e)},getValue:function(){return this.$el.val()},setValue:function(t){this.$el.val(e.nl2br(t)).trigger("change")}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/log-call/phone-field-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/app/views/base/view.js");return n("./bundles/oroui/js/extend/select2.js"),e.extend({events:{change:function(){this.trigger("change",this.$el.val())}},constructor:function t(e){t.__super__.constructor.call(this,e)},getValue:function(){return this.$el.select2("val")},setValue:function(t){this.$el.select2("val",t)}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/log-call/subject-field-view.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/app/views/base/view.js");return n("./bundles/oroui/js/extend/select2.js"),e.extend({constructor:function t(e){t.__super__.constructor.call(this,e)},getValue:function(){return this.$el.val()},setValue:function(t){this.$el.val(t).trigger("change")}})}.call(e,n,e,t))||(t.exports=o)},"./bundles/orohangoutscall/js/app/views/start-button-view.js":(t,e,n)=>{var o;o=function(t,e,o){"use strict";const s=n("./bundles/oroui/js/extend/jquery.js"),i=n("./bundles/oroui/js/extend/underscore.js"),l=n("./bundles/oroui/js/extend/scriptjs.js"),a=n("./bundles/oroui/js/app/views/base/view.js"),r=n("./bundles/oroui/js/app/services/module-config.js").Z(o.id),u=a.extend({className:"start-hangout-button-placeholder",hangoutOptions:null,token:null,constructor:function t(e){t.__super__.constructor.call(this,e)},initialize:function(t){this.setHangoutOptions(i.result(t,"hangoutOptions")),i.extend(this,i.pick(t,["token"])),u.__super__.initialize.call(this,t)},delegateEvents:function(t){return s(window).on("blur"+this.eventNamespace(),this.onWindowBlur.bind(this)),u.__super__.undelegateEvents.call(this,t)},undelegateEvents:function(){return s(window).off(this.eventNamespace()),u.__super__.undelegateEvents.call(this)},remove:function(){return s(window).off(this.eventNamespace()),this.$iframeContainer&&(this.$iframeContainer.find("iframe").off(this.eventNamespace()),this.$iframeContainer.remove(),delete this.$iframeContainer),u.__super__.remove.call(this)},_ensureElement:function(){u.__super__._ensureElement.call(this),this.className&&this.$el.addClass(i.result(this,"className"))},setHangoutOptions:function(t){this.hangoutOptions=t||{}},combineHangoutOptions:function(){const t=i.extend({render:"createhangout"},this.hangoutOptions),e=r.initialApps;if(!i.isEmpty(e)&&this.token){const n=this.token;t.initial_apps=i.map(e,(function(t){const e={token:n};return t.base_path&&r.appHost&&i.extend(e,{host:r.appHost,basePath:t.base_path,app:"app.js"}),{app_id:t.app_id,start_data:btoa(JSON.stringify(e)),app_type:t.app_type?t.app_type:"ROOM_APP"}}))}return t},enable:function(){this.$el.removeClass("disabled"),this.$el.closest(".control-group").show()},disable:function(){this.$el.addClass("disabled"),this.$el.closest(".control-group").hide()},render:function(){return this.$el.empty(),this._deferredRender(),l("//apis.google.com/js/platform.js",this._render.bind(this)),this},_render:function(){if(this.disposed)return;if(!gapi||!gapi.hangout)return this.deferredRender.reject(new Error("Cannot load Google API lib")),void delete this.deferredRender;let t;this.$iframeContainer=t=s('<div style="display: none"/>'),s("body").append(t),gapi.hangout.render(t[0],this.combineHangoutOptions()),t.find("iframe").one("load"+this.eventNamespace(),(e=>{this.$el.html(e.target),t.remove(),this._resolveDeferredRender()}))},onWindowBlur:function(){const t=this.$("iframe")[0];i.delay((()=>{t===window.document.activeElement&&this.trigger("click")}),500)}});return u}.call(e,n,e,t),void 0===o||(t.exports=o)},"./bundles/orohangoutscall/js/hangouts-event-broker.js":(t,e,n)=>{var o;void 0===(o=function(t){"use strict";const e=n("./bundles/oroui/js/tools.js"),o=n("./bundles/oroui/js/base-class.js").extend({interval:null,token:null,history:null,constructor:function t(e){t.__super__.constructor.call(this,e)},initialize:function(t){this.token=t.token||e.createRandomUUID(),this.history=[],setInterval(this._checkStorage.bind(this),50),o.__super__.initialize.call(this,t)},dispose:function(){this.disposed||(clearInterval(this.interval),o.__super__.dispose.call(this))},getToken:function(){return this.token},repeatTriggerFor:function(t){let e,n;if(this._events)for(let o=0;o<this.history.length;o++)if(e=this.history[o],n=this._events[e.name],n)for(let o=0;o<n.length;o++)n[o].context===t&&n[o].callback.call(n[o].ctx,e.data)},_checkStorage:function(){const t="from-app:"+this.token;let e=localStorage.getItem(t);if(e){localStorage.removeItem(t),e=JSON.parse(e);for(let t=0;t<e.length;t++)this.trigger(e[t].name,e[t].data),this.history.push(e[t])}},dispatchToApp:function(t,e){const n="to-app:"+this.token;localStorage.setItem(n,JSON.stringify({name:t,data:e}))}});return o}.call(e,n,e,t))||(t.exports=o)}}]);